}
clase_correcion = function(str) {
return(switch(as.character(str),
"1" = "Fatal",
"2" = "No fatal",
"3" = "Sólo daños",
str  # valor por defecto si no hay coincidencia
))
}
edo_correcion = function(str) {
return(switch(as.character(str),
"13" = "Hidalgo",
str  # valor por defecto si no hay coincidencia
))
}
sexo_correcion = function(str) {
return(switch(as.character(str),
"1" = "Se fugó",
"2" = "Hombre",
"3" = "Mujer",
str  # valor por defecto si no hay coincidencia
))
}
causaacci_correcion = function(str) {
return(switch(as.character(str),
"1" = "Conductor",
"2" = "Peatón o pasajero",
"3" = "Falla del vehículo",
"4" = "Mala condición del camino",
"5" = "Otra",
str  # valor por defecto si no hay coincidencia
))
}
datos = datos |> dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, MPIO, SEXO, EDAD, CAUSAACCI) |> dplyr::filter(EDO == 13)
datos$TIPACCID = sapply(datos$TIPACCID, tipaccid_correcion, simplify = T, USE.NAMES = F)
datos$CLASE = sapply(datos$CLASE, clase_correcion, simplify = T, USE.NAMES = F)
datos$EDO = sapply(datos$EDO, edo_correcion, simplify = T, USE.NAMES = F)
datos$SEXO = sapply(datos$SEXO, sexo_correcion, simplify = T, USE.NAMES = F)
datos$CAUSAACCI = sapply(datos$CAUSAACCI, causaacci_correcion, simplify = T, USE.NAMES = F)
mun = sf::read_sf("../Importantes_documentos_usar/Municipios/municipiosjair.shp")
datos = sf::read_sf("Datos/Sin filtrar/2023_shp/conjunto_de_datos/BASE MUNICIPAL_ACCIDENTES DE TRANSITO GEORREFERENCIADOS_2023.shp")
datos = datos |> dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, MPIO, SEXO, EDAD, CAUSAACCI) |> dplyr::filter(EDO == 13)
datos$TIPACCID = sapply(datos$TIPACCID, tipaccid_correcion, simplify = T, USE.NAMES = F)
datos$CLASE = sapply(datos$CLASE, clase_correcion, simplify = T, USE.NAMES = F)
datos$EDO = sapply(datos$EDO, edo_correcion, simplify = T, USE.NAMES = F)
datos$SEXO = sapply(datos$SEXO, sexo_correcion, simplify = T, USE.NAMES = F)
datos$CAUSAACCI = sapply(datos$CAUSAACCI, causaacci_correcion, simplify = T, USE.NAMES = F)
mun = sf::read_sf("../../Importantes_documentos_usar/Municipios/municipiosjair.shp")
mun = mun |> dplyr::select(CVE_MUN, NOM_MUN) |> sf::st_drop_geometry()
datos = merge(x = datos |> dplyr::mutate(MPIO = as.numeric(MPIO)) , y = mun |> dplyr::mutate(CVE_MUN = as.numeric(CVE_MUN)), by.x = "MPIO", by.y = "CVE_MUN")
datos = datos |> dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI) |>
dplyr::arrange(ANIO, MES, DIA, HORA, MINUTOS)
datos = datos[- 2076, ]
View(datos)
datos$NOM_MUN |> unique()
datos$SEXO |> unique()
datos = datos |> dplyr::filter(NOM_MUN == "Mineral de la Reforma") |> dplyr::filter(SEXO == "Mujer")
View(datos)
plot(datos$geometry)
View(datos)
### 2023
setwd("C:/Users/eagel/OneDrive/Escritorio/Lalo/Escuela/Gob/Interes/Accidentes_Mapa_prueba")
datos = sf::read_sf("Datos/Sin filtrar/2023_shp/conjunto_de_datos/BASE MUNICIPAL_ACCIDENTES DE TRANSITO GEORREFERENCIADOS_2023.shp")
mun = sf::read_sf("../../Importantes_documentos_usar/Municipios/municipiosjair.shp")
datos = datos |> dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, MPIO, SEXO, EDAD, CAUSAACCI) |> dplyr::filter(EDO == 13)
datos$TIPACCID = sapply(datos$TIPACCID, tipaccid_correcion, simplify = T, USE.NAMES = F)
datos$CLASE = sapply(datos$CLASE, clase_correcion, simplify = T, USE.NAMES = F)
datos$EDO = sapply(datos$EDO, edo_correcion, simplify = T, USE.NAMES = F)
datos$SEXO = sapply(datos$SEXO, sexo_correcion, simplify = T, USE.NAMES = F)
datos$CAUSAACCI = sapply(datos$CAUSAACCI, causaacci_correcion, simplify = T, USE.NAMES = F)
mun = mun |> dplyr::select(CVE_MUN, NOM_MUN) |> sf::st_drop_geometry()
datos = merge(x = datos |> dplyr::mutate(MPIO = as.numeric(MPIO)) , y = mun |> dplyr::mutate(CVE_MUN = as.numeric(CVE_MUN)), by.x = "MPIO", by.y = "CVE_MUN")
datos = datos |> dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI) |>
dplyr::arrange(ANIO, MES, DIA, HORA, MINUTOS)
plot(datos$geometry)
View(datos)
datos = "Input/2019_shp/ATUS_2019/conjunto_de_datos/BASE MUNICIPAL_ACCIDENTES DE TRANSITO GEORREFERENCIADOS_2019.shp" |>  sf::read_sf() |>  dplyr::filter(EDO == 13)
datos = "Input/2019_shp/ATUS_2019/conjunto_de_datos/BASE MUNICIPAL_ACCIDENTES DE TRANSITO GEORREFERENCIADOS_2019.shp" |>  sf::read_sf() |>  dplyr::filter(EDO == 13)
list.files(path = "Output/", pattern = "\\.geojson", full.names = T, recursive = T)
lista = list.files(path = "Output/", pattern = "\\.geojson", full.names = T, recursive = T)
datos = lapply(lista, function(x){
sf::st_read(x)
})
View(datos)
datos = datos |>  dplyr::plyr::bind_rows()
datos = datos |>  dplyr::bind_rows()
View(datos)
datos$TIPACCID |>  unique()
datos$CAUSAACCI |>  unique()
datos = datos |>
dplyr::filter(TIPACCID == "Colisión con peatón (atropellamiento)")
View(datos)
library(leaflet)
leaflet() |>  addTiles() |>  addMarkers(data = datos)
datos |>
sf::st_write("Output/Colision_con_peaton_2019_2024.geojson", delete_dsn = T)
a = sf::st_read("Output/Colision_con_peaton_2019_2024.geojson")
View(a)
datos$CLASE |>  table()
datos$CAUSAACCI |>  unique()
lista = list.files(path = "Output/", pattern = "\\.geojson", full.names = T, recursive = T)
datos = lapply(lista, function(x){
sf::st_read(x)
})
datos = datos |>  dplyr::bind_rows()
View(a)
View(datos)
a = datos |>
dplyr::filter(CAUSAACCI == "Peatón o pasajero")
View(a)
datos$TIPACCID |>  unique()
a$TIPACCID |>  unique()
a$TIPACCID |>  table()
b = sf::read_sf("Output/2024.geojson")
View(b)
View(b)
lista = list.files(path = "Input/", pattern = "\\.shp", full.names = T, recursive = T)
lista = list.files(path = "Input/", pattern = "\\.shp", full.names = T, recursive = T)
lista
archivos = list.files(path = "Input/", pattern = "\\.shp$", recursive = T, all.files = T)
nombres = archivos |> sub(pattern = "/.*", replacement = "") |>  stringr::str_squish()  |>  gsub(pattern = "_shp", replacement = "") |>   stringr::str_squish()
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp"
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf()
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf()
View(datos)
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf() |>  dplyr::filter(EDO == 13)
View(datos)
datos$vehi_invol = apply(datos |> sf::st_drop_geometry() |> dplyr::select(AUTOMOVIL:BICICLETA),MARGIN = 1,FUN=function(row){
names_reng=names(row)
cadena_final=''
for(id in 1:12){
val=row[id]
if(val!=0){
cadena_final=paste0(cadena_final,val," ",names_reng[id]," ")
}
}
return(cadena_final)
})
View(datos)
datos = datos |>
dplyr::filter(PEATHERIDO != 0 | PEATMUERTO != 0)
datos$TIPACCID |>  unique()
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf()
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf() |>   dplyr::filter(EDO == 13)
View(datos)
datos$vehi_invol = apply(datos |> sf::st_drop_geometry() |> dplyr::select(AUTOMOVIL:BICICLETA),MARGIN = 1,FUN=function(row){
names_reng=names(row)
cadena_final=''
for(id in 1:12){
val=row[id]
if(val!=0){
cadena_final=paste0(cadena_final,val," ",names_reng[id]," ")
}
}
return(cadena_final)
})
datos = datos |>
dplyr::mutate(
MPIO = MPIO |>  as.numeric()
)
datos = datos |>
dplyr::mutate(
TIPACCID = TIPACCID |> as.character(),
TIPACCID = dplyr::case_when(
TIPACCID == "0" ~ "Certificado cero",
TIPACCID == "1" ~ "Colisión con vehículo automotor",
TIPACCID == "2" ~ "Colisión con peatón (atropellamiento)",
TIPACCID == "3" ~ "Colisión con animal",
TIPACCID == "4" ~ "Colisión con objeto fijo",
TIPACCID == "5" ~ "Volcadura",
TIPACCID == "6" ~ "Caída de pasajero",
TIPACCID == "7" ~ "Salida del camino",
TIPACCID == "8" ~ "Incendio",
TIPACCID == "9" ~ "Colisión con ferrocarril",
TIPACCID == "10" ~ "Colisión con motocicleta",
TIPACCID == "11" ~ "Colisión con ciclista",
TIPACCID == "12" ~ "Otro",
T ~ TIPACCID
),
TIPACCID = TIPACCID |> stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CLASE = CLASE |> as.character(),
CLASE = dplyr::case_when(
CLASE == "1" ~ "Fatal",
CLASE == "2" ~ "No fatal",
CLASE == "3" ~ "Sólo daños",
TRUE ~ CLASE
),
CLASE = CLASE |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
EDO = EDO |>  as.character(),
EDO = dplyr::case_when(
EDO == "13" ~ "Hidalgo",
TRUE ~ EDO
),
EDO = EDO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
SEXO = SEXO |>  as.character(),
SEXO = dplyr::case_when(
SEXO == "1" ~ "Se fugó",
SEXO == "2" ~ "Hombre",
SEXO == "3" ~ "Mujer",
TRUE ~ SEXO
),
SEXO = SEXO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CAUSAACCI = CAUSAACCI |>  as.character(),
CAUSAACCI = dplyr::case_when(
CAUSAACCI == "1" ~ "Conductor",
CAUSAACCI == "2" ~ "Peatón o pasajero",
CAUSAACCI == "3" ~ "Falla del vehículo",
CAUSAACCI == "4" ~ "Mala condición del camino",
CAUSAACCI == "5" ~ "Otra",
TRUE ~ CAUSAACCI
),
CAUSAACCI = CAUSAACCI |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
DIASEMANA = DIASEMANA |>  as.character(),
DIASEMANA = dplyr::case_when(
DIASEMANA == "1" ~ "Lunes",
DIASEMANA == "2" ~ "Martes",
DIASEMANA == "3" ~ "Miércoles",
DIASEMANA == "4" ~ "Jueves",
DIASEMANA == "5" ~ "Viernes",
DIASEMANA == "6" ~ "Sábado",
DIASEMANA == "7" ~ "Domingo",
TRUE ~ DIASEMANA
),
DIASEMANA = DIASEMANA |> stringr::str_squish()
)
mun = "../../Importantes_documentos_usar/Municipios/municipiosjair.shp" |> sf::read_sf() |>
dplyr::select(CVE_MUN, NOM_MUN) |> sf::st_drop_geometry() |>
dplyr::mutate(CVE_MUN = CVE_MUN |>  as.numeric())
datos = datos |>
dplyr::left_join(y = mun, by = c("MPIO" = "CVE_MUN")) |>
dplyr::arrange(ANIO, MES, DIA, HORA, MINUTOS)
datos = datos |>
dplyr::rename(
TOT_MUERT = TOTMUERTOS,
TOT_HER = TOTHERIDOS,
CONDMUE = CONDMUERTO,
CONDHER = CONDHERIDO
)
View(datos)
datos = datos |>
dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI, DIASEMANA, vehi_invol, TOTMUERTOS, TOTHERIDOS, CONDMUERTO, CONDHERIDO, PEATMUERTO, PEATHERIDO)
source("C:/Users/SIGEH/Desktop/Lalo/Gob/Proyectos/Accidentes_Mapa_publico/Codigos/R/Filtracion_Vehiculos_Involucrados.R", echo = TRUE)
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf() |>   dplyr::filter(EDO == 13)
datos$vehi_invol = apply(datos |> sf::st_drop_geometry() |> dplyr::select(AUTOMOVIL:BICICLETA),MARGIN = 1,FUN=function(row){
names_reng=names(row)
cadena_final=''
for(id in 1:12){
val=row[id]
if(val!=0){
cadena_final=paste0(cadena_final,val," ",names_reng[id]," ")
}
}
return(cadena_final)
})
datos = datos |>
dplyr::mutate(
MPIO = MPIO |>  as.numeric()
)
datos = datos |>
dplyr::mutate(
TIPACCID = TIPACCID |> as.character(),
TIPACCID = dplyr::case_when(
TIPACCID == "0" ~ "Certificado cero",
TIPACCID == "1" ~ "Colisión con vehículo automotor",
TIPACCID == "2" ~ "Colisión con peatón (atropellamiento)",
TIPACCID == "3" ~ "Colisión con animal",
TIPACCID == "4" ~ "Colisión con objeto fijo",
TIPACCID == "5" ~ "Volcadura",
TIPACCID == "6" ~ "Caída de pasajero",
TIPACCID == "7" ~ "Salida del camino",
TIPACCID == "8" ~ "Incendio",
TIPACCID == "9" ~ "Colisión con ferrocarril",
TIPACCID == "10" ~ "Colisión con motocicleta",
TIPACCID == "11" ~ "Colisión con ciclista",
TIPACCID == "12" ~ "Otro",
T ~ TIPACCID
),
TIPACCID = TIPACCID |> stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CLASE = CLASE |> as.character(),
CLASE = dplyr::case_when(
CLASE == "1" ~ "Fatal",
CLASE == "2" ~ "No fatal",
CLASE == "3" ~ "Sólo daños",
TRUE ~ CLASE
),
CLASE = CLASE |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
EDO = EDO |>  as.character(),
EDO = dplyr::case_when(
EDO == "13" ~ "Hidalgo",
TRUE ~ EDO
),
EDO = EDO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
SEXO = SEXO |>  as.character(),
SEXO = dplyr::case_when(
SEXO == "1" ~ "Se fugó",
SEXO == "2" ~ "Hombre",
SEXO == "3" ~ "Mujer",
TRUE ~ SEXO
),
SEXO = SEXO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CAUSAACCI = CAUSAACCI |>  as.character(),
CAUSAACCI = dplyr::case_when(
CAUSAACCI == "1" ~ "Conductor",
CAUSAACCI == "2" ~ "Peatón o pasajero",
CAUSAACCI == "3" ~ "Falla del vehículo",
CAUSAACCI == "4" ~ "Mala condición del camino",
CAUSAACCI == "5" ~ "Otra",
TRUE ~ CAUSAACCI
),
CAUSAACCI = CAUSAACCI |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
DIASEMANA = DIASEMANA |>  as.character(),
DIASEMANA = dplyr::case_when(
DIASEMANA == "1" ~ "Lunes",
DIASEMANA == "2" ~ "Martes",
DIASEMANA == "3" ~ "Miércoles",
DIASEMANA == "4" ~ "Jueves",
DIASEMANA == "5" ~ "Viernes",
DIASEMANA == "6" ~ "Sábado",
DIASEMANA == "7" ~ "Domingo",
TRUE ~ DIASEMANA
),
DIASEMANA = DIASEMANA |> stringr::str_squish()
)
mun = "../../Importantes_documentos_usar/Municipios/municipiosjair.shp" |> sf::read_sf() |>
dplyr::select(CVE_MUN, NOM_MUN) |> sf::st_drop_geometry() |>
dplyr::mutate(CVE_MUN = CVE_MUN |>  as.numeric())
datos = datos |>
dplyr::left_join(y = mun, by = c("MPIO" = "CVE_MUN")) |>
dplyr::arrange(ANIO, MES, DIA, HORA, MINUTOS)
names(datos)
datos = datos |>
dplyr::rename(
TOT_MUERT = TOTMUERTOS,
TOT_HER = TOTHERIDOS,
CONDMUE = CONDMUERTO,
CONDHER = CONDHERIDO
)
datos = datos |>
dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI, DIASEMANA, vehi_invol, TOTMUERTOS, TOTHERIDOS, CONDMUERTO, CONDHERIDO, PEATMUERTO, PEATHERIDO)
datos = datos |>
dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI,
DIASEMANA, vehi_invol, TOT_MUERT, TOT_HER, CONDMUE, CONDHER, PEATMUERTO, PEATHERIDO)
datos = "Input/2024_shp/conjunto_de_datos/BASE_MUNICIPAL_ACCIDENTES_GEORREFERENCIADOS_2024.shp" |>  sf::read_sf() |>   dplyr::filter(EDO == 13)
datos$vehi_invol = apply(datos |> sf::st_drop_geometry() |> dplyr::select(AUTOMOVIL:BICICLETA),MARGIN = 1,FUN=function(row){
names_reng=names(row)
cadena_final=''
for(id in 1:12){
val=row[id]
if(val!=0){
cadena_final=paste0(cadena_final,val," ",names_reng[id]," ")
}
}
return(cadena_final)
})
datos = datos |>
dplyr::mutate(
MPIO = MPIO |>  as.numeric()
)
datos = datos |>
dplyr::mutate(
TIPACCID = TIPACCID |> as.character(),
TIPACCID = dplyr::case_when(
TIPACCID == "0" ~ "Certificado cero",
TIPACCID == "1" ~ "Colisión con vehículo automotor",
TIPACCID == "2" ~ "Colisión con peatón (atropellamiento)",
TIPACCID == "3" ~ "Colisión con animal",
TIPACCID == "4" ~ "Colisión con objeto fijo",
TIPACCID == "5" ~ "Volcadura",
TIPACCID == "6" ~ "Caída de pasajero",
TIPACCID == "7" ~ "Salida del camino",
TIPACCID == "8" ~ "Incendio",
TIPACCID == "9" ~ "Colisión con ferrocarril",
TIPACCID == "10" ~ "Colisión con motocicleta",
TIPACCID == "11" ~ "Colisión con ciclista",
TIPACCID == "12" ~ "Otro",
T ~ TIPACCID
),
TIPACCID = TIPACCID |> stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CLASE = CLASE |> as.character(),
CLASE = dplyr::case_when(
CLASE == "1" ~ "Fatal",
CLASE == "2" ~ "No fatal",
CLASE == "3" ~ "Sólo daños",
TRUE ~ CLASE
),
CLASE = CLASE |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
EDO = EDO |>  as.character(),
EDO = dplyr::case_when(
EDO == "13" ~ "Hidalgo",
TRUE ~ EDO
),
EDO = EDO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
SEXO = SEXO |>  as.character(),
SEXO = dplyr::case_when(
SEXO == "1" ~ "Se fugó",
SEXO == "2" ~ "Hombre",
SEXO == "3" ~ "Mujer",
TRUE ~ SEXO
),
SEXO = SEXO |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
CAUSAACCI = CAUSAACCI |>  as.character(),
CAUSAACCI = dplyr::case_when(
CAUSAACCI == "1" ~ "Conductor",
CAUSAACCI == "2" ~ "Peatón o pasajero",
CAUSAACCI == "3" ~ "Falla del vehículo",
CAUSAACCI == "4" ~ "Mala condición del camino",
CAUSAACCI == "5" ~ "Otra",
TRUE ~ CAUSAACCI
),
CAUSAACCI = CAUSAACCI |>  stringr::str_squish()
)
datos = datos |>
dplyr::mutate(
DIASEMANA = DIASEMANA |>  as.character(),
DIASEMANA = dplyr::case_when(
DIASEMANA == "1" ~ "Lunes",
DIASEMANA == "2" ~ "Martes",
DIASEMANA == "3" ~ "Miércoles",
DIASEMANA == "4" ~ "Jueves",
DIASEMANA == "5" ~ "Viernes",
DIASEMANA == "6" ~ "Sábado",
DIASEMANA == "7" ~ "Domingo",
TRUE ~ DIASEMANA
),
DIASEMANA = DIASEMANA |> stringr::str_squish()
)
mun = "../../Importantes_documentos_usar/Municipios/municipiosjair.shp" |> sf::read_sf() |>
dplyr::select(CVE_MUN, NOM_MUN) |> sf::st_drop_geometry() |>
dplyr::mutate(CVE_MUN = CVE_MUN |>  as.numeric())
datos = datos |>
dplyr::left_join(y = mun, by = c("MPIO" = "CVE_MUN")) |>
dplyr::arrange(ANIO, MES, DIA, HORA, MINUTOS)
datos = datos |>
dplyr::rename(
TOT_MUERT = TOTMUERTOS,
TOT_HER = TOTHERIDOS,
CONDMUE = CONDMUERTO,
CONDHER = CONDHERIDO,
PEATMUE = PEATMUERTO,
PEATHER = PEATHERIDO
)
datos = datos |>
dplyr::select(TIPACCID, CLASE, ANIO, MES, DIA, HORA, MINUTOS, EDO, NOM_MUN, SEXO, EDAD, CAUSAACCI,
DIASEMANA, vehi_invol, TOT_MUERT, TOT_HER, CONDMUE, CONDHER, PEATMUE, PEATHER)
View(datos)
archivos = list.files(path = "Input/", pattern = "\\.shp$", recursive = T, all.files = T)
nombres = archivos |> sub(pattern = "/.*", replacement = "") |>  stringr::str_squish()  |>  gsub(pattern = "_shp", replacement = "") |>   stringr::str_squish()
nombres
archivos = list.files(path = "Input/", pattern = "\\.shp$", recursive = T, all.files = T)
nombres = archivos |> sub(pattern = "/.*", replacement = "") |>  stringr::str_squish()  |>  gsub(pattern = "_shp", replacement = "") |>   stringr::str_squish()
guardar = NULL
for (i in seq_along(archivos)) {
cat("Vamos en: ", nombres[i], " se esta abriendo ", archivos[i], "\n")
datos = paste0("Input/", archivos[i]) |>  sf::read_sf() |>  dplyr::filter(EDO == 13)
source("Codigos/R/Filtracion_Pasajeros_Involucrados.R")
guardar = dplyr::bind_rows(guardar, datos)
}
interes = guardar
guardar$TIPACCID |>  unique()
guardar$CAUSAACCI |>  unique()
guardar = guardar |>
dplyr::filter(TIPACCID == "Colisión con peatón (atropellamiento)" | CAUSAACCI == "Peatón o pasajero"| PEATMUE > 0 | PEATHER > 0)
View(guardar)
guardar$TIPACCID |>  unique()
guardar$TIPACCID |>  table()
guardar |>  sf::write_sf("Output/Accidentes_Peatones_2019_2024.geojson", delete_dsn = T")
a = sf::read_sf("Output/Accidentes_Peatones_2019_2024.geojson")
guardar |>  sf::write_sf("Output/Accidentes_Peatones_2019_2024.geojson", delete_dsn = T)
a = sf::read_sf("Output/Accidentes_Peatones_2019_2024.geojson")
View(a)
